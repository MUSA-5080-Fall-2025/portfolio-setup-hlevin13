library(sf)
library(tidyverse)
library(ggplot2)
library(tigris)
library(tidycensus)
census_api_key("5a82e243438bea307ae1c04f150d539c4db5fa47")
# Read a shapefile
pa_counties <- st_read("data/Pennsylvania_County_Boundaries.shp")
# Read GeoJSON
districts <- st_read("data/districts.geojson")
hospitals <- st_read("data/hospitals.geojson")
https://data-pennshare.opendata.arcgis.com/datasets/pennsylvania-state-boundary/explore
hospitals <- hospitals %>%
st_transform(st_crs(pa_counties))
state_bounds <- st_read("https://gis.penndot.pa.gov/gis/rest/services/opendata/stateboundary/MapServer/0/query?outFields=*&where=1%3D1&f=geojson")
#get census tracts (boundaries only) using the tigris package
census_tracts <- tracts(state = "PA", cb = TRUE)
census_tracts <- census_tracts %>%
st_transform(st_crs(pa_counties))
metro_areas <- core_based_statistical_areas(cb = TRUE)
metro_areas <- metro_areas %>%
st_transform(st_crs(pa_counties))
#check out the magic of the geometry column.
st_geometry(pa_counties)
# Basic inspection
glimpse(pa_counties)
# Check coordinate reference system
st_crs(pa_counties)
# Get just the geometry
county_shapes <- st_geometry(pa_counties)
# Get just the data (no geometry)
county_data <- st_drop_geometry(pa_counties)
# Simple plot
plot(pa_counties)
View(metro_areas)
ggplot(pa_counties) +
geom_sf() +
theme_void()
allegheny <- pa_counties %>%
filter(COUNTY_NAM == "ALLEGHENY")
View(allegheny)
neighbors <- pa_counties %>%
st_filter(allegheny, .predicate = st_touches)
View(districts)
View(neighbors)
View(metro_areas)
allegheny_center <- st_centroid(allegheny)
nearby <- pa_counties %>%
st_filter(st_buffer(allegheny_center, dist = 50000))
ggplot(nearby) +
geom_sf() +
theme_void()
tracts_in_allegheny <- census_tracts %>%
st_filter(allegheny, .predicate = st_within)
# With ggplot2
ggplot(tracts_in_allegheny) +
geom_sf() +
theme_void()
ggplot(metro_areas) +
geom_sf() +
theme_void()
metro_tracts<- census_tracts %>%
st_filter(metro_areas, .predicate = st_intersects)
ggplot(metro_tracts) +
geom_sf() +
theme_void()
ggplot(rural_tracts) +
geom_sf() +
theme_void()
##spatial joins
# Get census tract data
pa_tracts <- tracts(state = "PA", county = "Allegheny", cb = TRUE)
tracts_with_counties <- census_tracts %>%
st_join(pa_counties)
View(tracts_with_counties)
View(tracts_in_allegheny)
ounty_summaries <- tracts_with_counties %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n(),
avg_area = mean(AREA_SQ_MI)
)
county_summaries
county_summaries <- tracts_with_counties %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarize(
n_tracts = n(),
avg_area = mean(AREA_SQ_MI)
)
county_summaries
##Distances
# Distance between county centroids
county_centers <- st_centroid(pa_counties)
ggplot(county_centers)+
geom_sf()+
theme_void()
distance_matrix <- st_distance(county_centers)
head(distance_matrix)
View(state_bounds)
pa_counties <- pa_counties %>%
mutate(
area_sqkm = as.numeric(st_area(.)) / 1000000  # Convert to sq km
)
View(pa_counties)
pa_counties <- pa_counties %>%
left_join(county_population_data, by = "GEOID") %>%
mutate(
pop_density = population / area_sqkm
)
philadelphia <- pa_counties %>%
filter(COUNTY_NAM == "Philadelphia")
philly_center <- st_centroid(philadelphia)
pa_counties <- pa_counties %>%
mutate(
dist_to_philly = as.numeric(st_distance(
st_centroid(.), philly_center
)) / 1000  # Convert to kilometers
)
hospitals_projected <- hospitals %>%
st_transform(crs = 3365)
st_crs(hospitals_projected)
hospital_buffers <- hospitals_projected %>%
st_buffer(dist = 32808.4)  # 10,000 meters = 32808.4 feet
ggplot(hospital_buffers)+
geom_sf()+
theme_void()
pa_tracts_data <- get_acs(
geography = "tract",
variables = c(
median_income = "B19013_001",
total_pop = "B01003_001",
over_65 = "B01001_020"  # Population 65 years and over
),
state = "PA",
year = 2022,
output = "wide"
)
tracts <- tracts %>%
left_join(pa_tracts_data, by = "GEOID")
View(pa_tracts_data)
census_tracts <- census_tracts %>%
left_join(pa_tracts_data, by = "GEOID")
low_income_tracts <- tracts %>%
filter(median_incomeE < 40000)
View(hospital_buffers)
low_income_tracts <- tracts %>%
filter(median_incomeE < 40000)
low_income_tracts  <- low_income_tracts  %>%
st_transform(crs = 3365)
low_income_tracts <- tracts %>%
filter(median_incomeE < 40000)
allegheny_boundary<- tracts_in_allegheny %>%
st_union()
library(patchwork)
p1 <- ggplot(tracts_in_allegheny) +
geom_sf(fill = "lightblue", color = "white") +
labs(title = "Individual Census Tracts") +
theme_void()
p2 <- ggplot() +
geom_sf(data = allegheny_boundary, fill = "darkblue") +
labs(title = "Unioned County Boundary") +
theme_void()
p1 | p2
districts <- districts %>%
st_transform(st_crs(tracts))
districts <- districts %>%
st_transform(st_crs(tracts))
districts <- districts %>%
st_transform(st_crs(census_tracts))
tracts_by_district <- tracts %>%
st_join(districts) %>%
st_drop_geometry() %>%
group_by(OBJECTID) %>%
summarize(
total_population = sum(total_popE),
avg_income = weighted.mean(median_incomeE, total_popE),
n_tracts = n()
)
districts_with_data <- districts %>%
left_join(tracts_by_district, by = "OBJECTID")
View(nearby)
View(metro_tracts)
View(ounty_summaries)
st_crs(hospitals)
areas<- pa_counties %>%
st_transform(4326) %>%  # Geographic
mutate(area_geographic = as.numeric(st_area(.))) %>%
st_transform(5070) %>%  # Albers
mutate(area_albers = as.numeric(st_area(.))) %>%
st_drop_geometry() %>%
select(COUNTY_NAM, area_geographic, area_albers) %>%
mutate(
ratio = area_albers / area_geographic,
difference_pct = (abs(area_albers - area_geographic) / area_albers) * 100
)
