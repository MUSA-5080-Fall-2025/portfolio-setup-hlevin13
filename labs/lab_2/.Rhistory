theme_minimal()+
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital",
subtitle = "Vulnerable Census Tracts in PA",
x = "Distance to nearest hsopital (mi)",
y = "Number of tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital",
subtitle = "Vulnerable Census Tracts in PA",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital",
subtitle = "Vulnerable Census Tracts in PA",
caption = "While most census tracts are near to a hospital, a clear disparity exists with some tracts being 50+ miles away from the nearest"
x = "Distance to Nearest Hospital (mi)",
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital",
subtitle = "Vulnerable Census Tracts in PA",
caption = "While most census tracts are near to a hospital, a clear disparity exists with some tracts being 50+ miles away from the nearest",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital in Pennsylvania",
subtitle = "While most census tracts are near to a hospital, a clear disparity exists with some tracts being 50+ miles away from the nearest",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital in Pennsylvania",
subtitle = "A clear disparity exists with some tracts being 50+ mi from the nearest hospital",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital in Pennsylvania",
subtitle = "A clear disparity exists with some census tracts being 50+ miles from the nearest hospital",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
bike_network <- st_read("step_7_data/Bike_Network.geojson")
schools <- st_read("step_7_data/Schools.geojson")
print(bike_network)
print(schools)
crime <- st_read("step_7_data/crime_2025/incidents_part1_part2")
crime <- st_read("step_7_data/crime_2025/incidents_part1_part2.shp")
print(crime)
crime <- st_read("step_7_data/crime_2022/incidents_part1_part2.shp")
bike_network <- st_transform(bike_network, crs = 3365)
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
summary(bike_network)
summary(schools)
summary(crime)
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union()
crime_total <- nrow(crime)
crime_schoolzone <- nrow(crime_schools)
crime_schools <- st_join(crime, school_buffer,
join = st_within, left = FALSE)
crime_schools <- st_join(crime, school_buffer, join = st_within, left = FALSE)
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
crime_schools <- st_join(crime, school_buffer, join = st_within, left = FALSE)
bike_network <- st_transform(bike_network, crs = 3365)
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union()
crime_nr_schools <- st_join(crime, school_buffer,join = st_within, left = FALSE)
# Your spatial analysis
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union()
crime_nr_schools <- st_join(crime, school_buffer,join = st_within, left = FALSE)
View(schools)
# Your spatial analysis
# Set CRS
bike_network <- st_transform(bike_network, crs = 3365)
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
# Create 1000ft buffers around each school to represent the safety zones
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union()
# Determine crimes within buffers/safety zones
crime_near_school <- st_join(
crime, school_buffer,
join = st_within, left = FALSE
)
# Your spatial analysis
# Set CRS
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
# Create 1000ft buffers around each school to represent the safety zones
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union() %>%
st_as_sf()
# Determine crimes within buffers/safety zones
crime_near_school <- st_join(
crime, school_buffer,
join = st_within, left = FALSE
)
# Count total crimes and the number that happened near schools
crime_total <- nrow(crime)
crime_schoolzone <- nrow(crime_near_school)
# Find percent of crimes near schools
crime_percent <- round((crime_schoolzone / crime_total) *100, 2)
# Results
cat("Total Crimes:", crime_total, "\n")
cat("Crimes within 1000ft of schools:", crime_schoolzone, "\n")
cat("Percent of crimes within 1000ft of schools:", crime_percent, "%\n")
ggplot() +
geom_sf(data = school_buffer,
fill = "lightblue",
alpha = 0.3) +
geom_sf(data = schools,
color = "darkblue",
size = 2) +
geom_sf(data = crime,
color = "red",
size = 1,
alpha = 0.5) +
labs(
title = "School Safety Zones and Crime",
subtitle = "1000ft safety buffer around schools and crime locations",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = school_buffer,
fill = "lightblue",
alpha = 0.3) +
geom_sf(data = schools,
color = "darkblue",
size = 2) +
geom_sf(data = crime,
color = "red",
size = .5,
alpha = 10) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = school_buffer,
fill = "lightgreen",
alpha = 0.3) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 2) +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .2) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = school_buffer,
fill = "lightgreen",
alpha = 1) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1) +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
geom_sf(data = school_buffer,
fill = "lightgreen",
alpha = 1) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1)
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
geom_sf(data = school_buffer,
fill = "navyblue") +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1)
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
geom_sf(data = school_buffer,
fill = "navyblue",
alpha = .3) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
ggplot() +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
geom_sf(data = school_buffer,
fill = "navyblue",
alpha = .8) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
# Load required packages
library(sf)
library(tidyverse)
library(tigris)
library(tidycensus)
library(scales)
library(patchwork)
library(here)
library(dplyr)
library(knitr)
library(ggplot2)
# Set Census API key
census_api_key("5a82e243438bea307ae1c04f150d539c4db5fa47")
# Load spatial data
pa_counties <- st_read("data/Pennsylvania_County_Boundaries.shp")
hospitals <- st_read("data/hospitals.geojson")
census_tracts <- tracts(state = "PA", cb = TRUE)
# Questions to answer:
hospitals %>%
group_by(FACILITY_N) %>%
summarise(count = n())
census_tracts %>%
group_by(GEOID) %>%
summarise(count = n())
st_crs(pa_counties)
st_crs(hospitals)
st_crs(census_tracts)
# Get demographic data from ACS
pa_tract_data <- get_acs(
geography = "tract",
state = "Pennsylvania",
variables = c(
total_population = "B01003_001",
median_income = "B19013_001",
over_65 = "B01001_020"),
survey = "acs5",
year = 2022,
output = "wide"
)
# Join to tract boundaries
census_tracts <- census_tracts %>%
left_join(pa_tract_data, by = "GEOID")
# Questions to answer:
pa_tract_data %>%
filter(is.na(median_incomeE)) %>%
count()
median(pa_tract_data$median_incomeE, na.rm = TRUE)
# Filter for vulnerable tracts based on your criteria
income_threshold <- quantile (
census_tracts$median_incomeE, 0.25, na.rm = TRUE)
# $55,924
census_tracts <- census_tracts %>%
mutate(pct_over_65 = (over_65E / total_populationE) *100)
age_threshold <- quantile (
census_tracts$pct_over_65, 0.75, na.rm = TRUE)
vulnerable_pop <- census_tracts %>%
filter(
median_incomeE < income_threshold,
pct_over_65 > age_threshold
)
vulnerable_pop <- vulnerable_pop %>%
mutate(
vulnerable = median_incomeE < income_threshold & pct_over_65 > age_threshold
)
# Transform to appropriate projected CRS
vulnerable_pop <- st_transform(vulnerable_pop, crs = 3365)
hospitals <- st_transform(hospitals, crs = 3365)
# Calculate distance from each tract centroid to nearest hospital
tract_centroid <- st_centroid(vulnerable_pop)
distance_matrix <- st_distance(tract_centroid, hospitals)
vulnerable_pop <- vulnerable_pop %>%
mutate(
hospital_dis = apply(distance_matrix, 1, min),
hospital_miles = as.numeric(hospital_dis) / 1609.34)
# Questions to answer
vulnerable_pop %>%
summarise(
avg_distance = mean(hospital_miles, na.rm = TRUE),
max_distance = max(hospital_miles, na.rm = TRUE),
over_15 = sum(hospital_miles > 15, na.rm = TRUE)
)
# Create underserved variable
vulnerable_pop <- vulnerable_pop %>%
mutate(
underserved = hospital_miles > 15 & median_incomeE < income_threshold & pct_over_65 > age_threshold
)
# Questions to answer
vulnerable_pop %>%
summarise(
underserved_count = sum(underserved, na.rm = TRUE),
total_tracts = n (),
underserved_pct = (underserved_count/total_tracts)*100
)
# Spatial join tracts to counties
pa_counties <- st_transform(pa_counties, crs = 3365)
vulnerable_pop <- st_transform(vulnerable_pop, crs = 3365)
tracts_with_counties <- vulnerable_pop %>%
st_join(pa_counties %>% select(COUNTY_NAM))
# Aggregate statistics by county
county_stats <- tracts_with_counties %>%
st_drop_geometry() %>%
group_by(COUNTY_NAM) %>%
summarise(
total_tracts = n(),
vulnerable_num = sum(vulnerable, na.rm = TRUE),
underserved_num = sum(underserved, na.rm =TRUE),
pct_underserved = (underserved_num/vulnerable_num)*100,
hosp_dist = mean(hospital_miles, na.rm = TRUE),
total = sum (total_populationE, na.rm = TRUE)
) %>%
ungroup()
# Create and format priority counties table
priority_counties <- county_stats %>%
arrange(desc(hosp_dist)) %>%
slice(1:10) %>%
select(COUNTY_NAM, total_tracts, total, pct_underserved, hosp_dist)
kable(priority_counties,
col.names = c("County", "Vulnerable Tracts", "Total Population", "Underserved Vulnerable Tracts (%)", "Distance to Nearest Hospital (mi)"),
caption = "Top 10 Priority Counties for Healthcare Investment",
format.args = list(big.mark = ",")
)
# Create county-level access map
county_map <- pa_counties %>%
st_transform(crs = st_crs(vulnerable_pop)) %>%
left_join(county_stats, by = "COUNTY_NAM")
hospitals <- st_transform(hospitals, crs = 3365)
ggplot() +
geom_sf(data = county_map,
aes(fill = pct_underserved),
color = "black", size = .25) +
geom_sf(data = hospitals,
color = "white",
size = 1) +
scale_fill_viridis_c(
name = "Percent Underserved",
option = "magma"
) +
labs(
title = "Healthcare Disparity Across Pennsylvania",
subtitle = "Percent of vulnerable census tracts underserved by county",
caption = "Source: ACS 2022 5-Year Estimates"
) +
theme_void()
# Create detailed tract-level map
vulnerable_pop <- vulnerable_pop %>%
mutate(
underserved_flag = ifelse (underserved == TRUE, "Underserved", "Other")
)
unique(vulnerable_pop$underserved_flag)
ggplot () +
geom_sf(data = vulnerable_pop,
aes(fill = underserved_flag),
color = "grey")+
geom_sf(data = pa_counties,
fill = NA,
color = "black",
size = 0.5) +
geom_sf(data = hospitals,
size = 2,
shape = 21,
fill = "cornflowerblue")+
scale_fill_manual(values = c("Underserved" = "orchid",
"Other" = "darkorange"),
name = "Vulnerability Status")+
labs(
title = "Underserved Vulnerable Tracts in Pennsylvania",
subtitle = "Census Tracts with Limited Access to Hospitals",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_void()
# Create distribution visualization
ggplot(vulnerable_pop, aes(x = hospital_miles)) +
geom_histogram(bins = 15, fill = "steelblue", alpha = 0.7) +
labs(
title = "Distribution of Distances to Nearest Hospital in Pennsylvania",
subtitle = "A clear disparity exists with some census tracts being 50+ miles from the nearest hospital",
x = "Distance to Nearest Hospital (mi)",
y = "Number of Tracts",
caption = "Source: ACS 2022 5-Year Estimates"
)+
theme_minimal()
# Load your additional dataset
schools <- st_read("step_7_data/Schools.geojson")
# OpenDataPhilly: unknown
crime <- st_read("step_7_data/crime_2022/incidents_part1_part2.shp")
# OpenDataPhilly; 2022
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
summary(schools)
summary(crime)
# Your spatial analysis
# Set CRS
schools <- st_transform(schools, crs = 3365)
crime <- st_transform(crime, crs = 3365)
# Create 1000ft buffers around each school to represent the safety zones
school_buffer <- schools %>%
st_buffer (dist = 1000) %>%
st_union() %>%
st_as_sf()
# Determine crimes within buffers/safety zones
crime_near_school <- st_join(
crime, school_buffer,
join = st_within, left = FALSE
)
# Count total crimes and the number that happened near schools
crime_total <- nrow(crime)
crime_schoolzone <- nrow(crime_near_school)
# Find percent of crimes near schools
crime_percent <- round((crime_schoolzone / crime_total) *100, 2)
# Results
cat("Total Crimes:", crime_total, "\n")
cat("Crimes within 1000ft of schools:", crime_schoolzone, "\n")
cat("Percent of crimes within 1000ft of schools:", crime_percent, "%\n")
# Map
ggplot() +
geom_sf(data = crime,
color = "tomato",
size = .5,
alpha = .1) +
geom_sf(data = school_buffer,
fill = "navyblue",
alpha = .8) +
geom_sf(data = schools,
color = "deepskyblue3",
size = 1) +
labs(
title = "School Safety Zones and Crime in Philadelphia, PA",
subtitle = "1000ft Safety Buffer Around Schools and Locations of Crime",
caption = "Source: OpenDataPhilly") +
theme_void()
# Set Census API key
.renviron
# Set Census API key
census_api_key("5a82e243438bea307ae1c04f150d539c4db5fa47")
